[INFO ] 2024-05-31 14:55:06.812 [main] [payment-processing-service,,] PaymentProcessingServiceApplication - Starting PaymentProcessingServiceApplication using Java 1.8.0_391 on MacBook-Air-M2.local with PID 23153 (/Users/priyanshugour/Desktop/ResumeProjects/payment-system-for-ecommerce/payment-processing-service/target/classes started by priyanshugour in /Users/priyanshugour/Desktop/ResumeProjects/payment-system-for-ecommerce)
[DEBUG] 2024-05-31 14:55:06.814 [main] [payment-processing-service,,] PaymentProcessingServiceApplication - Running with Spring Boot v2.7.14, Spring v5.3.29
[INFO ] 2024-05-31 14:55:06.815 [main] [payment-processing-service,,] PaymentProcessingServiceApplication - The following 1 profile is active: "local"
[INFO ] 2024-05-31 14:55:07.240 [main] [payment-processing-service,,] GenericScope - BeanFactory id=c9312260-e000-3416-9d13-20d8457e9608
[INFO ] 2024-05-31 14:55:07.475 [main] [payment-processing-service,,] TomcatWebServer - Tomcat initialized with port(s): 8082 (http)
[INFO ] 2024-05-31 14:55:07.479 [main] [payment-processing-service,,] Http11NioProtocol - Initializing ProtocolHandler ["http-nio-8082"]
[INFO ] 2024-05-31 14:55:07.479 [main] [payment-processing-service,,] StandardService - Starting service [Tomcat]
[INFO ] 2024-05-31 14:55:07.479 [main] [payment-processing-service,,] StandardEngine - Starting Servlet engine: [Apache Tomcat/9.0.78]
[INFO ] 2024-05-31 14:55:07.569 [main] [payment-processing-service,,] [/] - Initializing Spring embedded WebApplicationContext
[INFO ] 2024-05-31 14:55:07.569 [main] [payment-processing-service,,] ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 723 ms
[INFO ] 2024-05-31 14:55:08.227 [main] [payment-processing-service,,] EndpointLinksResolver - Exposing 1 endpoint(s) beneath base path '/actuator'
[INFO ] 2024-05-31 14:55:08.263 [main] [payment-processing-service,,] Http11NioProtocol - Starting ProtocolHandler ["http-nio-8082"]
[INFO ] 2024-05-31 14:55:08.274 [main] [payment-processing-service,,] TomcatWebServer - Tomcat started on port(s): 8082 (http) with context path ''
[INFO ] 2024-05-31 14:55:08.287 [main] [payment-processing-service,,] PaymentProcessingServiceApplication - Started PaymentProcessingServiceApplication in 1.652 seconds (JVM running for 2.068)
[INFO ] 2024-05-31 14:55:08.544 [RMI TCP Connection(2)-127.0.0.1] [payment-processing-service,,] HikariDataSource - HikariPool-1 - Starting...
[INFO ] 2024-05-31 14:55:08.545 [RMI TCP Connection(3)-127.0.0.1] [payment-processing-service,,] [/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
[INFO ] 2024-05-31 14:55:08.545 [RMI TCP Connection(3)-127.0.0.1] [payment-processing-service,,] DispatcherServlet - Initializing Servlet 'dispatcherServlet'
[INFO ] 2024-05-31 14:55:08.546 [RMI TCP Connection(3)-127.0.0.1] [payment-processing-service,,] DispatcherServlet - Completed initialization in 1 ms
[INFO ] 2024-05-31 14:55:08.693 [RMI TCP Connection(2)-127.0.0.1] [payment-processing-service,,] HikariDataSource - HikariPool-1 - Start completed.
[INFO ] 2024-05-31 14:57:23.329 [http-nio-8082-exec-1] [payment-processing-service,b0583f919946cce5,b0583f919946cce5] PaymentController - /STATUS_UPDATE :  payment request is -> TransactionReqRes(id=null, userId=2, paymentMethodId=1, providerId=1, paymentTypeId=1, amount=17.1, currency=EUR, txnStatusId=1, txnReference=431c0eaf-72ef-4dd7-94e9-9c5418060539, txnDetailsId=null, providerCode=null, providerMessage=null, debitorAccount=4444333322221111, creditorAccount=1111222233334444, providerReference=null, merchantTransactionReference=ecom-xyz-100)
[INFO ] 2024-05-31 14:57:23.341 [http-nio-8082-exec-1] [payment-processing-service,b0583f919946cce5,b0583f919946cce5] PaymentStatusServiceImpl - /STATUS_UPDATE :  updating transaction -> 1
[INFO ] 2024-05-31 14:57:23.341 [http-nio-8082-exec-1] [payment-processing-service,b0583f919946cce5,b0583f919946cce5] TransactionStatusFactory - /STATUS_UPDATE :  fetching transaction status handler for -> CREATED
[INFO ] 2024-05-31 14:57:23.343 [http-nio-8082-exec-1] [payment-processing-service,b0583f919946cce5,b0583f919946cce5] CreatedTransactionStatusHandler - /STATUS_UPDATE :  creating new transaction -> Transaction(id=null, userId=2, paymentMethodId=1, providerId=1, paymentTypeId=1, amount=17.1, currency=EUR, txnStatusId=1, txnReference=431c0eaf-72ef-4dd7-94e9-9c5418060539, txnDetailsId=null, providerCode=null, providerMessage=null, debitorAccount=4444333322221111, creditorAccount=1111222233334444, providerReference=null, merchantTransactionReference=ecom-xyz-100)
[INFO ] 2024-05-31 14:57:23.349 [http-nio-8082-exec-1] [payment-processing-service,b0583f919946cce5,b0583f919946cce5] TransactionDetailsDaoImpl - /STATUS_UPDATE :  :: fetching transactionDetails for :: 000.001
[INFO ] 2024-05-31 14:57:23.349 [http-nio-8082-exec-1] [payment-processing-service,b0583f919946cce5,b0583f919946cce5] TransactionDetailsDaoImpl - /STATUS_UPDATE : getTransactionDetailsById -> SELECT * FROM  Transaction_Details WHERE code = :code 
[INFO ] 2024-05-31 14:57:23.363 [http-nio-8082-exec-1] [payment-processing-service,b0583f919946cce5,b0583f919946cce5] TransactionDetailsDaoImpl - /STATUS_UPDATE :  :: transaction Details from DB  = TransactionDetails(id=1, code=000.001, message=payment created)
[INFO ] 2024-05-31 14:57:23.364 [http-nio-8082-exec-1] [payment-processing-service,b0583f919946cce5,b0583f919946cce5] TransactionImpl - /STATUS_UPDATE :  Insert Transaction query -> INSERT INTO Transaction (userId, paymentMethodId, providerId, paymentTypeId, amount, currency, txnStatusId, txnReference, txnDetailsId, debitorAccount,creditorAccount, merchantTransactionReference) VALUES(:userId, :paymentMethodId, :providerId, :paymentTypeId, :amount, :currency, :txnStatusId, :txnReference, :txnDetailsId, :debitorAccount, :creditorAccount, :merchantTransactionReference)
[INFO ] 2024-05-31 14:57:23.372 [http-nio-8082-exec-1] [payment-processing-service,b0583f919946cce5,b0583f919946cce5] TransactionLogDaoImpl - /STATUS_UPDATE :  Insert Transaction log query -> INSERT INTO Transaction_Log (transactionId, txnFromStatus, txnToStatus) VALUES(:transactionId, :txnFromStatus, :txnToStatus)
[INFO ] 2024-05-31 14:57:23.401 [http-nio-8082-exec-2] [payment-processing-service,7b825f4cedbcba87,7b825f4cedbcba87] PaymentController - /PROCESS_PAYMENT :  processingServiceRequest is -> ProcessingServiceRequest(transactionId=4, firstName=Priyanshu, lastName=Gour, email=priyanshugour1@gmail.com)
[INFO ] 2024-05-31 14:57:23.401 [http-nio-8082-exec-2] [payment-processing-service,7b825f4cedbcba87,7b825f4cedbcba87] TransactionImpl - /PROCESS_PAYMENT :  :: fetching Transaction Details  for :: 4
[INFO ] 2024-05-31 14:57:23.401 [http-nio-8082-exec-2] [payment-processing-service,7b825f4cedbcba87,7b825f4cedbcba87] TransactionImpl - /PROCESS_PAYMENT :  getTransactionById query -> Select * from Transaction where id=:id 
[INFO ] 2024-05-31 14:57:23.404 [http-nio-8082-exec-2] [payment-processing-service,7b825f4cedbcba87,7b825f4cedbcba87] TransactionImpl - /PROCESS_PAYMENT :  :: transaction Details from DB  = Transaction(id=4, userId=2, paymentMethodId=1, providerId=1, paymentTypeId=1, amount=17.1, currency=EUR, txnStatusId=1, txnReference=431c0eaf-72ef-4dd7-94e9-9c5418060539, txnDetailsId=1, providerCode=null, providerMessage=null, debitorAccount=4444333322221111, creditorAccount=1111222233334444, providerReference=null, merchantTransactionReference=ecom-xyz-100)
[INFO ] 2024-05-31 14:57:23.404 [http-nio-8082-exec-2] [payment-processing-service,7b825f4cedbcba87,7b825f4cedbcba87] PaymentServiceImpl - /PROCESS_PAYMENT : transaction is -> Transaction(id=4, userId=2, paymentMethodId=1, providerId=1, paymentTypeId=1, amount=17.1, currency=EUR, txnStatusId=1, txnReference=431c0eaf-72ef-4dd7-94e9-9c5418060539, txnDetailsId=1, providerCode=null, providerMessage=null, debitorAccount=4444333322221111, creditorAccount=1111222233334444, providerReference=null, merchantTransactionReference=ecom-xyz-100)
[INFO ] 2024-05-31 14:57:23.405 [http-nio-8082-exec-2] [payment-processing-service,7b825f4cedbcba87,7b825f4cedbcba87] PaymentServiceImpl - /PROCESS_PAYMENT : providerHandler is -> com.cpt.payments.service.provider.handler.TrustlyProviderHandler@483f286e
[INFO ] 2024-05-31 14:57:23.405 [http-nio-8082-exec-2] [payment-processing-service,7b825f4cedbcba87,7b825f4cedbcba87] TrustlyProviderHandler - /PROCESS_PAYMENT :  processing trustly payment 
[INFO ] 2024-05-31 14:57:23.406 [http-nio-8082-exec-2] [payment-processing-service,7b825f4cedbcba87,7b825f4cedbcba87] TrustlyProviderHandler - /PROCESS_PAYMENT :  trustly provider request -> TrustlyProviderRequest(transactionReference=431c0eaf-72ef-4dd7-94e9-9c5418060539, creditorNumber=1111222233334444, debitorNumber=4444333322221111, currency=EUR, amount=17.1, firstName=Priyanshu, lastName=Gour, email=priyanshugour1@gmail.com)
[INFO ] 2024-05-31 14:57:23.409 [http-nio-8082-exec-2] [payment-processing-service,7b825f4cedbcba87,7b825f4cedbcba87] TrustlyProviderHandler - /PROCESS_PAYMENT :  updating transaction status to pending 
[INFO ] 2024-05-31 14:57:23.409 [http-nio-8082-exec-2] [payment-processing-service,7b825f4cedbcba87,7b825f4cedbcba87] PaymentStatusServiceImpl - /PROCESS_PAYMENT :  updating transaction -> 2
[INFO ] 2024-05-31 14:57:23.409 [http-nio-8082-exec-2] [payment-processing-service,7b825f4cedbcba87,7b825f4cedbcba87] TransactionStatusFactory - /PROCESS_PAYMENT :  fetching transaction status handler for -> PENDING
[INFO ] 2024-05-31 14:57:23.409 [http-nio-8082-exec-2] [payment-processing-service,7b825f4cedbcba87,7b825f4cedbcba87] PendingTransactionStatusHandler - /PROCESS_PAYMENT :  transaction PENDING -> Transaction(id=4, userId=2, paymentMethodId=1, providerId=1, paymentTypeId=1, amount=17.1, currency=EUR, txnStatusId=2, txnReference=431c0eaf-72ef-4dd7-94e9-9c5418060539, txnDetailsId=1, providerCode=null, providerMessage=null, debitorAccount=4444333322221111, creditorAccount=1111222233334444, providerReference=null, merchantTransactionReference=ecom-xyz-100)
[INFO ] 2024-05-31 14:57:23.409 [http-nio-8082-exec-2] [payment-processing-service,7b825f4cedbcba87,7b825f4cedbcba87] TransactionDetailsDaoImpl - /PROCESS_PAYMENT :  :: fetching transactionDetails for :: 000.002
[INFO ] 2024-05-31 14:57:23.409 [http-nio-8082-exec-2] [payment-processing-service,7b825f4cedbcba87,7b825f4cedbcba87] TransactionDetailsDaoImpl - /PROCESS_PAYMENT : getTransactionDetailsById -> SELECT * FROM  Transaction_Details WHERE code = :code 
[INFO ] 2024-05-31 14:57:23.410 [http-nio-8082-exec-2] [payment-processing-service,7b825f4cedbcba87,7b825f4cedbcba87] TransactionDetailsDaoImpl - /PROCESS_PAYMENT :  :: transaction Details from DB  = TransactionDetails(id=2, code=000.002, message=payment pending)
[INFO ] 2024-05-31 14:57:23.411 [http-nio-8082-exec-2] [payment-processing-service,7b825f4cedbcba87,7b825f4cedbcba87] TransactionImpl - /PROCESS_PAYMENT :  update Transaction query -> Update Transaction SET txnStatusId=:txnStatusId, txnDetailsId=:txnDetailsId WHERE id=:id 
[INFO ] 2024-05-31 14:57:23.414 [http-nio-8082-exec-2] [payment-processing-service,7b825f4cedbcba87,7b825f4cedbcba87] TransactionLogDaoImpl - /PROCESS_PAYMENT :  Insert Transaction log query -> INSERT INTO Transaction_Log (transactionId, txnFromStatus, txnToStatus) VALUES(:transactionId, :txnFromStatus, :txnToStatus)
[INFO ] 2024-05-31 14:57:23.538 [http-nio-8082-exec-2] [payment-processing-service,7b825f4cedbcba87,7b825f4cedbcba87] HttpRestTemplateEngine - /PROCESS_PAYMENT : Got Exception:org.springframework.web.client.HttpServerErrorException$InternalServerError: 500 : "{"errorCode":"30004","errorMessage":"Failed to create trustly signature","tpProviderError":false}"
[DEBUG] 2024-05-31 14:57:23.538 [http-nio-8082-exec-2] [payment-processing-service,7b825f4cedbcba87,7b825f4cedbcba87] HttpRestTemplateEngine - /PROCESS_PAYMENT : createCustomErrorResponse||response:<500 INTERNAL_SERVER_ERROR Internal Server Error,{"errorCode":"30004","errorMessage":"Failed to create trustly signature","tpProviderError":false},[Content-Type:"application/json", Transfer-Encoding:"chunked", Date:"Fri, 31 May 2024 09:27:23 GMT", Connection:"close"]>
[INFO ] 2024-05-31 14:57:23.539 [http-nio-8082-exec-2] [payment-processing-service,7b825f4cedbcba87,7b825f4cedbcba87] TrustlyProviderHandler - /PROCESS_PAYMENT :  INTERNAL payment creation at provider failed -> <500 INTERNAL_SERVER_ERROR Internal Server Error,{"errorCode":"30004","errorMessage":"Failed to create trustly signature","tpProviderError":false},[Content-Type:"application/json", Transfer-Encoding:"chunked", Date:"Fri, 31 May 2024 09:27:23 GMT", Connection:"close"]>
[INFO ] 2024-05-31 14:57:23.540 [http-nio-8082-exec-2] [payment-processing-service,7b825f4cedbcba87,7b825f4cedbcba87] PaymentProcessingServiceExceptionHandler - /PROCESS_PAYMENT :  validation exception is -> Failed to create trustly signature
[INFO ] 2024-05-31 14:57:23.541 [http-nio-8082-exec-2] [payment-processing-service,7b825f4cedbcba87,7b825f4cedbcba87] PaymentProcessingServiceExceptionHandler - /PROCESS_PAYMENT :  paymentResponse is -> ErrorResponse(errorCode=30004, errorMessage=Failed to create trustly signature)
[INFO ] 2024-05-31 14:57:56.128 [SpringApplicationShutdownHook] [payment-processing-service,,] HikariDataSource - HikariPool-1 - Shutdown initiated...
[INFO ] 2024-05-31 14:57:56.141 [SpringApplicationShutdownHook] [payment-processing-service,,] HikariDataSource - HikariPool-1 - Shutdown completed.
